<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <base target="_top">
    <style>
      body { font: 14px/1.4 Arial, sans-serif; margin: 16px; color: #202124; }
      h2 { margin: 0 0 12px; font-size: 16px; font-weight: 600; }
      .sheet-list { max-height: 320px; overflow: auto; border: 1px solid #e0e0e0; border-radius: 8px; padding: 8px; }
      .sheet-item { display: flex; align-items: center; padding: 6px 4px; gap: 8px; }
      .actions-top { display: flex; gap: 8px; margin: 8px 0 12px; }
      .btn { border: 1px solid transparent; border-radius: 6px; padding: 6px 12px; cursor: pointer; }
      .btn-primary { background: #1a73e8; color: #fff; }
      .btn-primary:hover { background: #1765c1; }
      .btn-secondary { background: #f1f3f4; color: #202124; border-color: #dadce0; }
      .btn-secondary:hover { background: #e9ecef; }
      .btn-ghost { background: transparent; color: #1a73e8; }
      .footer { display: flex; justify-content: flex-end; gap: 8px; margin-top: 14px; }
      .empty { color: #5f6368; font-style: italic; padding: 12px; }
    </style>
  </head>
  <body>
    <h2>Which of the following sheets will be processed?</h2>

    <div class="actions-top">
      <button class="btn btn-secondary" id="selectAll">Select all</button>
      <button class="btn btn-ghost" id="deselectAll">Deselect all</button>
    </div>

    <div id="list" class="sheet-list"></div>
    <div class="footer">
      <button class="btn btn-secondary" id="cancel">Cancel</button>
      <button class="btn btn-primary" id="confirm">Process selected</button>
    </div>

    <script>
      const list = document.getElementById('list');
      const mode = window.__MODE__ || 'create';
      const sheets = window.__SHEETS__ || [];

      function escapeHtml(s) {
        return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      }

      function render() {
        if (!sheets.length) {
          list.innerHTML = '<div class="empty">No sheets found.</div>';
          return;
        }
        list.innerHTML = sheets.map(s =>
          `<label class="sheet-item">
             <input type="checkbox" data-id="${s.id}">
             <span>${escapeHtml(s.name)}</span>
           </label>`
        ).join('');
      }

      function setAll(checked) {
        list.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = checked);
      }

      document.getElementById('selectAll').addEventListener('click', () => setAll(true));
      document.getElementById('deselectAll').addEventListener('click', () => setAll(false));
      document.getElementById('cancel').addEventListener('click', () => google.script.host.close());

      document.getElementById('confirm').addEventListener('click', () => {
        const ids = Array.from(list.querySelectorAll('input[type="checkbox"]:checked'))
          .map(cb => Number(cb.getAttribute('data-id')));
        if (!ids.length) { google.script.host.close(); return; }
        if (mode === 'create') {
          google.script.run.withSuccessHandler(() => google.script.host.close())
            ._processMultipleSheetsCreate_(ids);
        } else {
          google.script.run.withSuccessHandler(() => google.script.host.close())
            ._processMultipleSheetsDelete_(ids);
        }
      });

      render();
    </script>
  </body>
</html>